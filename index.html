<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ASTRA - Automated Store Transaction and Records Assistant</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <!-- Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-light">

  <!-- Gradient Banner Header -->
  <header class="banner-gradient py-5 mb-4">
    <div class="container-xl">
      <h1 class="display-5 fw-bold text-white text-center mb-2">
        ASTRA: Automated Store Transaction and Records Assistant
      </h1>
      <p class="lead text-white-50 text-center mb-0">
        Fast, friendly, and organized store management.
      </p>
    </div>
  </header>

  <main class="container-xl pb-5">

    <!-- ROW 1: Process a New Sale (wide row card) -->
    <section class="card card-row shadow-sm mb-4">
      <div class="card-header bg-white border-0 pb-0">
        <h2 class="h5 mb-0"><i class="bi bi-cash-coin me-2"></i>Process a New Sale</h2>
      </div>

      <div class="card-body pt-3">
        <div class="row g-4 align-items-start">
          <!-- Inputs (left) -->
          <div class="col-12 col-lg-5">
            <div class="mb-3">
              <label for="customerName" class="form-label">Customer Name</label>
              <input type="text" id="customerName" class="form-control" placeholder="Required for Credit; Optional for Cash" />
            </div>

            <div class="mb-3 position-relative">
              <label for="itemsSoldName" class="form-label">Product Name</label>
              <input type="text" id="itemsSoldName" class="form-control" placeholder="Type to search product" oninput="showProductDropdown();updateSelectedUnit()" autocomplete="off" />
              <ul id="product-dropdown" class="list-group position-absolute w-100 d-none dropdown-elevated"></ul>
            </div>

            <div class="mb-3">
              <label class="form-label d-flex align-items-center gap-2 mb-1">
                <span>Quantity</span>
                <span id="selectedUnit" class="badge text-bg-primary">unit: —</span>
              </label>
              <input type="number" id="itemsSoldQuantity" class="form-control" placeholder="e.g., 2" min="1" />
            </div>

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="cashReceived" class="form-label mb-1">Cash Received (₱)</label>
                <input type="number" id="cashReceived" class="form-control" placeholder="Enter cash" step="0.01" min="0" oninput="calculateChange()" />
              </div>
              <div class="col-12 col-md-6">
                <div class="d-flex justify-content-between py-2 px-3 bg-body-tertiary rounded-3 mt-md-4">
                  <span class="fw-semibold">Change:</span>
                  <span id="change" class="fw-bold">₱0.00</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Order summary + totals (right) -->
          <div class="col-12 col-lg-7">
            <h3 class="h6 mb-2">Current Order</h3>
            <div class="table-responsive table-scroll">
              <table id="order-summary-items" class="table table-sm table-striped align-middle mb-0">
                <thead class="table-secondary sticky-head">
                  <tr>
                    <th>#</th>
                    <th>Item</th>
                    <th>Qty (Unit)</th>
                    <th class="text-end">Price</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-12">
                <div class="d-flex justify-content-between py-2 px-3 bg-body-tertiary rounded-3">
                  <span class="fw-semibold">Subtotal:</span>
                  <span id="subtotal" class="fw-bold">₱0.00</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sticky footer with buttons -->
      <div class="card-footer card-footer-sticky">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary flex-grow-1" onclick="addItemToSale()">
            <i class="bi bi-plus-circle me-1"></i>Add Item to Order
          </button>
          <button class="btn btn-success flex-grow-1" onclick="processSale('Cash')">
            <i class="bi bi-check-circle me-1"></i>Process Cash Sale
          </button>
          <button class="btn btn-warning flex-grow-1" onclick="processSale('Credit')">
            <i class="bi bi-journal-text me-1"></i>Process Credit (Utang) Sale
          </button>

        </div>
      </div>
    </section>
     <!-- ROW 1: Daily Sales (alone) -->
    <section class="card card-row shadow-sm mb-4">
      <div class="card-header bg-white border-0 pb-0">
        <h2 class="h5 mb-0"><i class="bi bi-receipt-cutoff me-2"></i>Daily Sales</h2>
      </div>
      <div class="card-body pt-3">
        <div id="sales-display" class="table-responsive table-scroll"></div>
      </div>
    </section>

    <!-- ROW 2 (B): Store Management & Inventory -->
    <section class="card card-row shadow-sm mb-4">
      <div class="card-header bg-white border-0 pb-0">
        <h2 class="h5 mb-0"><i class="bi bi-box-seam me-2"></i>Store Management & Inventory</h2>
      </div>

      <div class="card-body pt-3">
        <div class="row g-4">
          <!-- Product form -->
          <div class="col-12 col-lg-4">
            <h3 class="h6 text-uppercase text-muted">Add / Update Product</h3>

            <div class="mb-3">
              <label for="productName" class="form-label">Product Name</label>
              <input type="text" id="productName" class="form-control" placeholder="Product Name" />
            </div>

            <div class="mb-3">
              <label for="productUnit" class="form-label">Unit of Measure</label>
              <select id="productUnit" class="form-select">
                <option value="pc">pc (Piece)</option>
                <option value="kg">kg (Kilogram)</option>
                <option value="g">g (Gram)</option>
                <option value="L">L (Liter)</option>
                <option value="mL">mL (Milliliter)</option>
                <option value="pack">pack (Package)</option>
                <option value="doz">doz (Dozen)</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="productStock" class="form-label">Stock</label>
              <input type="number" id="productStock" class="form-control" placeholder="Stock" min="0" />
            </div>

            <div class="mb-3">
              <label for="productPrice" class="form-label">Price (₱)</label>
              <input type="number" id="productPrice" class="form-control" placeholder="Price (₱)" step="0.01" min="0" />
            </div>
          </div>

          <!-- Inventory table -->
          <div class="col-12 col-lg-8">
            <h3 class="h6 text-uppercase text-muted mb-2">Product Inventory</h3>
            <div id="inventory-display" class="table-responsive table-scroll"></div>
          </div>
        </div>
      </div>

      <!-- Sticky footer for product actions -->
      <div class="card-footer card-footer-sticky">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary" onclick="addProduct()" id="addProductButton">
            <i class="bi bi-save2 me-1"></i>Add / Save Product
          </button>
          <button class="btn btn-outline-secondary d-none" onclick="cancelEdit()" id="cancelEditButton">
            <i class="bi bi-x-circle me-1"></i>Cancel
          </button>
        </div>
      </div>
    </section>

   

    <!-- ROW 3: Credit & Payments -->
    <section class="card card-row shadow-sm mb-4">
      <div class="card-header bg-white border-0 pb-0">
        <h2 class="h5 mb-0"><i class="bi bi-wallet2 me-2"></i>Credit & Payments</h2>
      </div>
      <div class="card-body pt-3">
        <div class="row g-4">
          <!-- Credit History Search -->
          <div class="col-12 col-xl-6">
            <h3 class="h6"><i class="bi bi-search-heart me-2"></i>Credit History Search</h3>
            <label for="creditCustomerSearch" class="form-label">Search Customer Utang</label>
            <input type="text" id="creditCustomerSearch" class="form-control" placeholder="Enter Customer Name (Leave blank to show ALL)" />
            <div id="creditHistoryDetails" class="mt-3 border rounded p-2 table-scroll">
              <p class="text-muted mb-0">Loading credit history...</p>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
              <span class="fw-semibold">Overall Pending Balance:</span>
              <span id="creditTotal" class="badge text-bg-dark fs-6">₱0.00</span>
            </div>
          </div>

          <!-- Record Payment -->
          <div class="col-12 col-xl-6">
            <h3 class="h6">Record Customer Payment</h3>

            <div class="mb-3">
              <label for="paymentCustomerName" class="form-label">Customer</label>
              <select id="paymentCustomerName" onchange="populatePendingTransactions()" class="form-select"></select>
            </div>

            <div class="mb-3">
              <label for="pendingTransactionId" class="form-label">Specific Transaction (for Partial Payment)</label>
              <select id="pendingTransactionId" onchange="updateAmountPaidPlaceholder()" class="form-select"></select>
            </div>

            <div class="mb-3">
              <label for="amountPaid" class="form-label">Amount Paid (₱)</label>
              <input type="number" id="amountPaid" class="form-control" placeholder="Enter amount paid" step="0.01" min="0" />
            </div>

            <div class="d-grid">
              <button class="btn btn-success" onclick="recordPayment()">
                <i class="bi bi-cash-stack me-1"></i>Process Payment
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ROW 4: System Log -->
    <section class="card card-row shadow-sm">
      <div class="card-header bg-white border-0 pb-0">
        <h2 class="h5 mb-0"><i class="bi bi-gear-wide-connected me-2"></i>System Log</h2>
      </div>
      <div class="card-body pt-3">
        <pre id="output-log" class="border rounded p-3 bg-body-tertiary" style="min-height: 220px; max-height: 280px; overflow:auto;"></pre>

        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-outline-secondary" onclick="exportDataAsTxt('inventory')">
            <i class="bi bi-download me-1"></i>Export Inventory (.txt)
          </button>
          <button class="btn btn-outline-secondary" onclick="exportDataAsTxt('credit')">
            <i class="bi bi-download me-1"></i>Export Credit History (.txt)
          </button>
          <button class="btn btn-outline-secondary" onclick="exportDataAsTxt('log')">
            <i class="bi bi-download me-1"></i>Export System Log (.txt)
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <!-- App JS -->
  <script src="app.js"></script>
</body>
</html>
